{
  "version": 3,
  "sources": [
    "node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "/Users/domin/Workspace/papillon/papillon.js",
    "/Users/domin/Workspace/papillon/src/observer.js",
    "/Users/domin/Workspace/papillon/src/state.js"
  ],
  "names": [],
  "mappings": "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",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "import State from './src/state';\nimport Observer from './src/observer';\n\nexport {\n  State,\n  Observer\n};\n",
    "import State from './state';\n\n/**\n * This module provides interface to link callback method with object's properties\n * changes. Watched properties are redefined as getter/setter property.\n * Module will throw error for non-configurable properties.\n *\n * Getting or setting watched property will trigger request for change detection\n * which will be executed before next repaint.\n *\n * @class\n */\nexport default class Observer {\n\n  /**\n   * Initialize observer instance\n   *\n   * ### Example:\n   *\n   * ```javascript\n   * let host = {test: 'one'};\n   * let observer = new Observer(host, 'test', changelog => {\n   *   console.dir(changelog.test);\n   * });\n   *\n   * // Will triger log in console before next repaint\n   * host.test = 'two';\n   * ```\n   * @constructor\n   * @param   {Object}          host\n   * @param   {String|String[]} properties\n   * @param   {Function}        callback - takes `changelog` object as argument\n   * @returns {Object}          Observer instance\n   */\n  constructor(host, properties, callback) {\n    if (!host || !properties || !callback) {\n      throw new TypeError('Invalid arguments');\n    }\n\n    this.host = host;\n    this.callback = callback;\n\n    this.properties = [].concat(properties).map((property)=> {\n      let descriptor = Object.getOwnPropertyDescriptor(this.host, property);\n\n      if (!descriptor.configurable) {\n        throw new TypeError(`'${property}': Configurable property required`);\n      }\n\n      return { property, descriptor };\n    });\n\n    this.state = new State(\n      this.properties.reduce( (list, {property, descriptor}) => {\n        let getter, setter;\n\n        list[property] = this.host[property];\n\n        if (descriptor.get) {\n          getter = ()=> list[property] = descriptor.get.call(this.host);\n        } else {\n          getter = ()=> list[property];\n        }\n\n        if (descriptor.set) {\n          setter = (value)=> {\n            descriptor.set.call(this.host, value);\n            getter();\n          };\n        } else {\n          setter = (value)=> list[property] = value;\n        }\n\n        Object.defineProperty(this.host, property, {\n          configurable: true,\n          enumerable: descriptor.enumerable,\n          get: ()=> {\n            this.check();\n            return getter();\n          },\n          set: (value)=> {\n            setter(value);\n            this.check();\n          }\n        });\n\n        return list;\n      }, {})\n    );\n  }\n\n  /**\n   * Schedule change detection with `window.requestAnimationFrame`.\n   *\n   * This method is automatically called when watched property is set or get.\n   * You don't have to use this method directly. If your code changes\n   * host properties by other reference, you have to schedule checking manually.\n   */\n  check() {\n    if (!this.requestId && !this.checking) {\n      this.requestId = window.requestAnimationFrame(()=> {\n        this.checking = true;\n\n        if (this.state.isChanged()) {\n          this.callback(this.state.changelog);\n        }\n\n        this.checking = this.requestId = void 0;\n      });\n    }\n  }\n\n  /**\n   * Cancel scheduled checking request and revert watched properites to\n   * original definition.\n   *\n   * If your code not requires host object with state before loading\n   * observer, you don't have to call this method.\n   *\n   * After destroying Observer instance, accessing host properties will not\n   * trigger `check()` method.\n   */\n  destroy() {\n    if (this.requestId) {\n      window.cancelAnimationFrame(this.requestId);\n    }\n\n    this.properties.forEach(({property, descriptor}) => {\n      if (!descriptor.get && !descriptor.set) {\n        descriptor.value = this.state.target[property];\n      }\n      Object.defineProperty(this.host, property, descriptor);\n    });\n  }\n}\n",
    "let map = new WeakMap();\nlet timestamp = 0;\nlet request = false;\n\n/**\n * This module provides singleton interface for storing objects states.\n * Only last state is cached and last changes between checks are provided.\n *\n * Singleton pattern ensures low memory usage and consistent state between\n * objects that refference to themselves. Checking two objects that reference\n * to third one will check the third only once.\n *\n * Module uses a special state counter that increase only before next\n * repaint. Checking object state multiply times before counter is changed\n * will return the same results.\n *\n * ### instance properties\n *\n * * `target` - reference to object, which state is stored.\n * * `lastCheck` - value of state counter when object was checked\n * * `lastChange` - value of state counter when object has changed\n * * `changelog` - list of changes from last check\n *\n * ### changelog structure\n *\n * Example:\n *\n * ```\n * {\n *  one: { type: 'add' },\n *  two: { type: 'update', oldValue: 'some'},\n *  three: { type: 'delete', oldValue: 'before removed'},\n *  four: { type: 'modify', changelog: {...} }\n * }\n * ```\n *\n * Types:\n *\n * * `add` - define property, ex. `obj.asd = 'value'`\n * * `update` - change reference or change primitive value\n * * `delete` - remove property\n * * `modify` - nested changes in `Object` property, contains object changelog\n *\n * @class\n */\nexport default class State {\n\n  /**\n   * Generates unique counter for indexing states.\n   * @static\n   */\n  static now() {\n    if (!request) {\n      timestamp = timestamp + 1;\n      request = window.requestAnimationFrame(\n        ()=> request = undefined\n      );\n    }\n    return timestamp;\n  }\n\n  static isObject(target) {\n    return typeof(target) === 'object' && target !== null;\n  }\n\n  static is(v1, v2) {\n    if (v1 === 0 && v2 === 0) {\n      return 1 / v1 === 1 / v2;\n    }\n    if (v1 !== v1) {\n      return v2 !== v2;\n    }\n    return v1 === v2;\n  }\n\n  /**\n   * ### example\n   *\n   * ```javascript\n   * var state = new State({ one: 'two' });\n   * ```\n   *\n   * @constructor\n   * @param   {Object} target\n   * @returns {Object} State instance\n   */\n  constructor(target) {\n    if (!State.isObject(target)) {\n      throw new TypeError('Invalid arguments');\n    }\n    let state = map.get(target);\n    if (state) { return state; }\n    map.set(target, this);\n\n    this.cache = Object.keys(target).reduce((cache, key)=> {\n      let value = cache[key] = target[key];\n      if (State.isObject(value)) {\n        new State(value);\n      }\n      return cache;\n    }, {});\n\n    this.target = target;\n    this.lastCheck = State.now();\n    this.lastChange = 0;\n  }\n\n  /**\n   * Checks if target object has changed from last state.\n   * If it is true, method regenerates `changelog`.\n   * @returns {Boolean}\n   */\n  isChanged() {\n    let timestamp = State.now();\n\n    if (timestamp > this.lastCheck) {\n      let changed = false;\n\n      this.lastCheck = timestamp;\n      this.changelog = {};\n\n      Object.keys(this.cache).forEach((key)=> {\n        if (!this.target.hasOwnProperty(key)) {\n          let value = this.cache[key];\n          this.changelog[key] = { type: 'delete', oldValue: value };\n          changed = true;\n        }\n      });\n\n      this.cache = Object.keys(this.target).reduce((cache, key)=> {\n        let value = this.target[key];\n\n        if (!this.cache.hasOwnProperty(key)) {\n          this.changelog[key] = { type:'add' };\n          changed = true;\n        } else if (!State.is(value, this.cache[key])) {\n          this.changelog[key] = this.changelog[key] || { type: 'update'};\n          this.changelog[key].oldValue = this.cache[key];\n          changed = true;\n        }\n\n        if (State.isObject(value)) {\n          let nestedState = new State(value);\n          if (nestedState.isChanged()) {\n            changed = true;\n            if (!this.changelog[key]) {\n              this.changelog[key] = { type: 'modify' };\n              this.changelog[key].changelog = nestedState.changelog;\n            }\n          }\n        }\n\n        cache[key] = this.target[key];\n        return cache;\n      }, {});\n\n      if (changed) {\n        this.lastChange = this.lastCheck;\n      } else {\n        this.changelog = undefined;\n      }\n    }\n\n    return this.lastChange === timestamp;\n  }\n}\n"
  ]
}